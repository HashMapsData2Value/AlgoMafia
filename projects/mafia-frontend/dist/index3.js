const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["App-5d429a6e.js","index.js","index.css","bowser.js"])))=>i.map(i=>d[i]);
import{B,a as X,b as z,_ as J}from"./index.js";import{W as x,B as V}from"./bowser.js";function v(n,e,t,o){return new(t||(t=Promise))(function(s,i){function a(l){try{d(o.next(l))}catch(r){i(r)}}function c(l){try{d(o.throw(l))}catch(r){i(r)}}function d(l){var r;l.done?s(l.value):(r=l.value,r instanceof t?r:new t(function(h){h(r)})).then(a,c)}d((o=o.apply(n,[])).next())})}class g extends Error{constructor(e,t,...o){super(...o),Error.captureStackTrace&&Error.captureStackTrace(this,g),this.name="PeraWalletConnectError",this.data=e,this.message=t}}const T=new class{constructor(n){this.listener=void 0,this.channel=n.channel}setupListener({onReceiveMessage:n}){this.close(),this.listener=e=>{if(typeof e.data=="object")try{e.data.channel===this.channel&&n(e)}catch(t){console.error(t)}},window.addEventListener("message",this.listener)}sendMessage({message:n,targetWindow:e,origin:t,timeout:o=1e3}){setTimeout(()=>{const s={channel:this.channel,message:n};e.postMessage(s,{targetOrigin:t||"*"})},o)}close(){this.listener&&(window.removeEventListener("message",this.listener),this.listener=void 0)}}({channel:"pera-web-wallet"}),F=700,Y=50;function Q(){const n=document.querySelector('meta[name="name"]'),e=document.querySelector('meta[name="description"]');let{title:t}=document,o="";return n instanceof HTMLMetaElement&&(t=n.content),e instanceof HTMLMetaElement&&(o=e.content),{title:t,description:o,url:window.location.origin,favicon:Z()[0]}}function Z(){const n=document.getElementsByTagName("link"),e=[];for(let t=0;t<n.length;t++){const o=n[t],s=o.getAttribute("rel");if(s&&s.toLowerCase().indexOf("icon")>-1){const i=o.getAttribute("href");if(i&&i.toLowerCase().indexOf("https:")===-1&&i.toLowerCase().indexOf("http:")===-1&&i.indexOf("//")!==0){let a=`${window.location.protocol}//${window.location.host}`;if(i.indexOf("/")===0)a+=i;else{const c=window.location.pathname.split("/");c.pop(),a+=`${c.join("/")}/${i}`}e.push(a)}else if((i==null?void 0:i.indexOf("//"))===0){const a=window.location.protocol+i;e.push(a)}else i&&e.push(i)}}return e}function G(n){return new Promise((e,t)=>{try{const o=window.open(n,"_blank");let s=0;const i=setInterval(()=>{if(s+=1,s===Y)return clearInterval(i),void t(new g({type:"MESSAGE_NOT_RECEIVED"},"Couldn't open Pera Wallet, please try again."));o&&(o.closed===!0&&(clearInterval(i),t(new g({type:"OPERATION_CANCELLED"},"Operation cancelled by user"))),T.sendMessage({message:{type:"TAB_OPEN"},origin:n,targetWindow:o}))},F);T.setupListener({onReceiveMessage:a=>{a.data.message.type==="TAB_OPEN_RECEIVED"&&(clearInterval(i),e(o))}})}catch(o){t(o)}})}const y="pera-wallet-connect-modal-wrapper",O="pera-wallet-redirect-modal-wrapper",L="pera-wallet-sign-txn-toast-wrapper",de="pera-wallet-sign-txn-modal-wrapper",ee="pera-wallet-modal";function M(n){const e=document.createElement("div");return e.setAttribute("id",n),document.body.appendChild(e),e}function U(){M(O).innerHTML="<pera-wallet-redirect-modal></pera-wallet-redirect-modal>"}function j(){M(L).innerHTML="<pera-wallet-sign-txn-toast></pera-wallet-sign-txn-toast>"}function b(n){const e=document.getElementById(n);e&&e.remove()}const S={WALLET:"PeraWallet.Wallet",WALLETCONNECT:"walletconnect"};function C(){return typeof localStorage>"u"?void 0:localStorage}function q(n,e){var t;(t=C())===null||t===void 0||t.setItem(S.WALLET,JSON.stringify({type:e||"pera-wallet",accounts:n,selectedAccount:n[0]}))}function I(){var n;const e=(n=C())===null||n===void 0?void 0:n.getItem(S.WALLET);return e?JSON.parse(e):null}function H(){return new Promise((n,e)=>{var t,o;try{(t=C())===null||t===void 0||t.removeItem(S.WALLETCONNECT),(o=C())===null||o===void 0||o.removeItem(S.WALLET),n(void 0)}catch(s){e(s)}})}function te(n){const e=n.slice();for(let t=e.length-1;t>0;t--){const o=Math.floor(Math.random()*(t+1));[e[t],e[o]]=[e[o],e[t]]}return e}const ne="https://wc.perawallet.app/config.json";function oe(){return function(n,e={}){return fetch(n,e).then(t=>t.json()).then(t=>t)}(ne,{cache:"no-store"})}function N(){return v(this,void 0,void 0,function*(){let n={bridgeURL:"",webWalletURL:"",isWebWalletAvailable:!1,shouldDisplayNewBadge:!1,shouldUseSound:!0,silent:!1,promoteMobile:!1};try{const e=yield oe();e.web_wallet!==void 0&&e.web_wallet_url&&(n.isWebWalletAvailable=e.web_wallet),e.display_new_badge!==void 0&&(n.shouldDisplayNewBadge=e.display_new_badge),e.use_sound!==void 0&&(n.shouldUseSound=e.use_sound),e.silent!==void 0&&(n.silent=e.silent),e.promote_mobile!==void 0&&(n.promoteMobile=e.promote_mobile),n=Object.assign(Object.assign({},n),{bridgeURL:te(e.servers||[])[0]||"",webWalletURL:e.web_wallet_url||""})}catch(e){console.log(e)}return n})}function W(n){return Uint8Array.from(window.atob(n),e=>e.charCodeAt(0))}function k(n,e){return{id:Date.now()*Math.pow(10,3)+Math.floor(Math.random()*Math.pow(10,3)),jsonrpc:"2.0",method:n,params:e}}function _(){return typeof navigator<"u"}function ie(){return _()&&/Android/i.test(navigator.userAgent)}function ue(){return _()&&/iPhone|iPad|iPod/i.test(navigator.userAgent)}function E(){return _()&&/iPhone|iPod|Android/i.test(navigator.userAgent)}function he(){if(!_())return null;const{userAgent:n}=navigator;let e;return e=n.match(/DuckDuckGo/i)?"DuckDuckGo":n.match(/OPX/i)?"Opera GX":navigator.brave?"Brave":V.getParser(navigator.userAgent).getBrowserName(),e}const ge=ie()?"algorand://":"perawallet-wc://",pe="https://perawallet.app/download/";function K(n){return{ROOT:`https://${n}`,CONNECT:`https://${n}/connect`,TRANSACTION_SIGN:`https://${n}/transaction/sign`}}function $({method:n,signTxnRequestParams:e,signer:t,chainId:o,webWalletURL:s,resolve:i,reject:a}){const c=K(s);(function(){v(this,void 0,void 0,function*(){try{const d=yield G(c.TRANSACTION_SIGN);if(d){let r;n==="SIGN_TXN"?r={type:"SIGN_TXN",txn:e}:n==="SIGN_DATA"&&t&&o&&(r={type:"SIGN_DATA",data:e,signer:t,chainId:o}),r&&T.sendMessage({message:r,origin:c.TRANSACTION_SIGN,targetWindow:d})}const l=setInterval(()=>{(d==null?void 0:d.closed)===!0&&(a(new g({type:`${n}_CANCELLED`},"Transaction signing is cancelled by user.")),clearInterval(l))},2e3);T.setupListener({onReceiveMessage:r=>function({event:h,newPeraWalletTab:u,method:m,resolve:w,reject:p}){switch(h.data.message.type){case"SIGN_TXN_CALLBACK":u==null||u.close(),w(h.data.message.signedTxns.map(f=>W(f.signedTxn)));break;case"SIGN_DATA_CALLBACK":u==null||u.close(),w(h.data.message.signedData.map(f=>W(f.signedData)));break;case"SIGN_TXN_NETWORK_MISMATCH":p(new g({type:`${m}_NETWORK_MISMATCH`,detail:h.data.message.error},h.data.message.error||"Network mismatch"));break;case"SIGN_TXN_CALLBACK_ERROR":u==null||u.close(),p(new g({type:`${m}_CANCELLED`},h.data.message.error));break;case"SESSION_DISCONNECTED":u==null||u.close(),H(),p(new g({type:"SESSION_DISCONNECTED",detail:h.data.message.error},h.data.message.error))}}({event:r,newPeraWalletTab:d,method:n,resolve:i,reject:a})})}catch(d){a(d)}})})()}function ae({webWalletURL:n,chainId:e,resolve:t,reject:o}){const s=K(n);return function(){return v(this,void 0,void 0,function*(){try{const a=yield G(s.CONNECT);a&&T.sendMessage({message:{type:"CONNECT",data:Object.assign(Object.assign({},Q()),{chainId:e})},origin:s.CONNECT,targetWindow:a});const c=setInterval(()=>{(a==null?void 0:a.closed)===!0&&(o(new g({type:"CONNECT_CANCELLED"},"Connect is cancelled by user")),clearInterval(c),i())},2e3);T.setupListener({onReceiveMessage:d=>function({event:l,newPeraWalletTab:r,resolve:h,reject:u}){if(h&&l.data.message.type==="CONNECT_CALLBACK"){const m=l.data.message.data.addresses;q(m,"pera-wallet-web"),h(m),b(y),r==null||r.close()}else l.data.message.type==="CONNECT_NETWORK_MISMATCH"&&(u(new g({type:"CONNECT_NETWORK_MISMATCH",detail:l.data.message.error},l.data.message.error||"Your wallet is connected to a different network to this dApp. Update your wallet to the correct network (MainNet or TestNet) to continue.")),b(y),r==null||r.close())}({event:d,newPeraWalletTab:a,resolve:t,reject:o})})}catch(a){i(),o(a)}})};function i(){b(y)}}function se({isWebWalletAvailable:n,shouldDisplayNewBadge:e,shouldUseSound:t,compactMode:o,promoteMobile:s,singleAccount:i,selectedAccount:a}){return{open:(c={isWebWalletAvailable:n,shouldDisplayNewBadge:e,shouldUseSound:t,compactMode:o,promoteMobile:s,singleAccount:i,selectedAccount:a},d=>{if(!document.getElementById(y)){const l=M(y),r=`${d}&algorand=true`,{isWebWalletAvailable:h,shouldDisplayNewBadge:u,shouldUseSound:m,compactMode:w,promoteMobile:p,singleAccount:f,selectedAccount:A}=c;l.innerHTML=`<pera-wallet-connect-modal uri="${r}" is-web-wallet-avaliable="${h}" should-display-new-badge="${u}" should-use-sound="${m}" compact-mode="${w}" promote-mobile="${p}" single-account="${f}" selected-account="${A||""}"></pera-wallet-connect-modal>`}}),close:()=>b(y)};var c}class re{constructor(e){this.bridge=(e==null?void 0:e.bridge)||"",this.connector=null,this.shouldShowSignTxnToast=(e==null?void 0:e.shouldShowSignTxnToast)===void 0||e.shouldShowSignTxnToast,this.chainId=e==null?void 0:e.chainId,this.compactMode=(e==null?void 0:e.compactMode)||!1,this.singleAccount=(e==null?void 0:e.singleAccount)||!1}get platform(){return function(){const e=I();let t=null;return(e==null?void 0:e.type)==="pera-wallet"?t="mobile":(e==null?void 0:e.type)==="pera-wallet-web"&&(t="web"),t}()}get isConnected(){var e;return this.platform==="mobile"?!!this.connector:this.platform==="web"&&!!(!((e=I())===null||e===void 0)&&e.accounts.length)}get isPeraDiscoverBrowser(){return this.checkIsPeraDiscoverBrowser()}connect(e){return new Promise((t,o)=>v(this,void 0,void 0,function*(){var s;try{if(!((s=this.connector)===null||s===void 0)&&s.connected)try{yield this.connector.killSession()}catch{}const{isWebWalletAvailable:i,bridgeURL:a,webWalletURL:c,shouldDisplayNewBadge:d,shouldUseSound:l,promoteMobile:r}=yield N(),h=ae({resolve:t,reject:o,webWalletURL:c,chainId:this.chainId,isCompactMode:this.compactMode});i&&(window.onWebWalletConnect=h),this.connector=new x({bridge:this.bridge||a||"https://bridge.walletconnect.org",qrcodeModal:se({isWebWalletAvailable:i,shouldDisplayNewBadge:d,shouldUseSound:l,compactMode:this.compactMode,promoteMobile:r,singleAccount:this.singleAccount,selectedAccount:e==null?void 0:e.selectedAccount})}),yield this.connector.createSession({chainId:this.chainId||4160}),function(u,m){var w,p,f,A;const R=document.getElementById(u),P=(p=(w=R==null?void 0:R.querySelector(u.replace("-wrapper","")))===null||w===void 0?void 0:w.shadowRoot)===null||p===void 0?void 0:p.querySelector(`.${ee}`),D=(A=(f=P==null?void 0:P.querySelector("pera-wallet-modal-header"))===null||f===void 0?void 0:f.shadowRoot)===null||A===void 0?void 0:A.getElementById("pera-wallet-modal-header-close-button");D==null||D.addEventListener("click",()=>{m(),b(u)})}(y,()=>o(new g({type:"CONNECT_MODAL_CLOSED"},"Connect modal is closed by user"))),this.connector.on("connect",(u,m)=>{var w,p;u&&o(u),t(((w=this.connector)===null||w===void 0?void 0:w.accounts)||[]),q(((p=this.connector)===null||p===void 0?void 0:p.accounts)||[])})}catch(i){console.log(i),o(new g({type:"SESSION_CONNECT",detail:i},i.message||"There was an error while connecting to Pera Wallet"))}}))}reconnectSession(){return new Promise((e,t)=>v(this,void 0,void 0,function*(){var o,s;try{const i=I();if(!i)return void e([]);if((i==null?void 0:i.type)==="pera-wallet-web"){const{isWebWalletAvailable:a}=yield N();a?e(i.accounts||[]):t(new g({type:"SESSION_RECONNECT",detail:"Pera Web is not available"},"Pera Web is not available"))}this.connector&&e(this.connector.accounts||[]),this.bridge=((o=function(){var a;const c=(a=C())===null||a===void 0?void 0:a.getItem(S.WALLETCONNECT);return c?JSON.parse(c):null}())===null||o===void 0?void 0:o.bridge)||"",this.bridge&&(this.connector=new x({bridge:this.bridge}),e(((s=this.connector)===null||s===void 0?void 0:s.accounts)||[])),this.isConnected||e([])}catch(i){yield this.disconnect(),t(new g({type:"SESSION_RECONNECT",detail:i},i.message||"There was an error while reconnecting to Pera Wallet"))}}))}disconnect(){var e;return v(this,void 0,void 0,function*(){let t;this.isConnected&&this.platform==="mobile"&&(t=(e=this.connector)===null||e===void 0?void 0:e.killSession(),t==null||t.then(()=>{this.connector=null})),yield H()})}signTransactionWithMobile(e){return v(this,void 0,void 0,function*(){const t=k("algo_signTxn",[e]);try{try{const{silent:o}=yield N(),s=(yield this.connector.sendCustomRequest(t,{forcePushNotification:!o})).filter(Boolean);return typeof s[0]=="string"?s.map(W):s.map(i=>Uint8Array.from(i))}catch(o){return yield Promise.reject(new g({type:"SIGN_TRANSACTIONS",detail:o},o.message||"Failed to sign transaction"))}}finally{b(O),b(L)}})}signTransactionWithWeb(e,t){return new Promise((o,s)=>$({signTxnRequestParams:e,webWalletURL:t,method:"SIGN_TXN",resolve:o,reject:s}))}signDataWithMobile({data:e,signer:t,chainId:o}){return v(this,void 0,void 0,function*(){const s=k("algo_signData",e.map(i=>Object.assign(Object.assign({},i),{signer:t,chainId:o})));try{try{const{silent:i}=yield N(),a=(yield this.connector.sendCustomRequest(s,{forcePushNotification:!i})).filter(Boolean);return typeof a[0]=="string"?a.map(W):a.map(c=>Uint8Array.from(c))}catch(i){return yield Promise.reject(new g({type:"SIGN_TRANSACTIONS",detail:i},i.message||"Failed to sign transaction"))}}finally{b(O),b(L)}})}signDataWithWeb({data:e,signer:t,chainId:o,webWalletURL:s}){return new Promise((i,a)=>$({method:"SIGN_DATA",signTxnRequestParams:e,signer:t,chainId:o,webWalletURL:s,resolve:i,reject:a}))}checkIsPeraDiscoverBrowser(){return window.navigator.userAgent.includes("pera")}signTransaction(e,t){return v(this,void 0,void 0,function*(){if(this.platform==="mobile"&&(E()?U():!E()&&this.shouldShowSignTxnToast&&j(),!this.connector))throw new Error("PeraWalletConnect was not initialized correctly.");const o=e.flatMap(s=>s.map(i=>function(a,c){let d;c&&!(a.signers||[]).includes(c)&&(d=[]);const l={txn:(r=a.txn,B.from(X.encodeUnsignedTransaction(r)).toString("base64"))};var r;return Array.isArray(d)&&(l.signers=d),a.authAddr&&(l.authAddr=a.authAddr),a.message&&(l.message=a.message),a.msig&&(l.msig=a.msig),l}(i,t)));if(this.platform==="web"){const{webWalletURL:s}=yield N();return this.signTransactionWithWeb(o,s)}return this.signTransactionWithMobile(o)})}signData(e,t){return v(this,void 0,void 0,function*(){const o=this.chainId||4160;if(this.platform==="mobile"&&(E()?U():!E()&&this.shouldShowSignTxnToast&&j(),!this.connector))throw new Error("PeraWalletConnect was not initialized correctly.");if(this.platform==="web"){const{webWalletURL:i}=yield N();return this.signDataWithWeb({data:e,signer:t,chainId:o,webWalletURL:i})}const s=e.map(i=>Object.assign(Object.assign({},i),{data:B.from(i.data).toString("base64")}));return this.signDataWithMobile({data:s,signer:t,chainId:o})})}}typeof window<"u"&&(window.global=window,window.Buffer=window.Buffer||z,J(()=>import("./App-5d429a6e.js"),__vite__mapDeps([0,1,2,3])));const we=Object.freeze(Object.defineProperty({__proto__:null,PeraWalletConnect:re},Symbol.toStringTag,{value:"Module"}));export{E as B,ue as D,b as N,ie as P,ge as U,O as g,y as h,we as i,pe as j,ee as m,L as p,de as w,he as x};
